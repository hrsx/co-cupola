
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<base target="_blank">
<title>Google Earth Sample</title>

<script type="text/javascript" src="http://www.google.com/jsapi?hl=en&amp;key=ABQIAAAAuMdjTKAMJZ-jFrRfJbEAbRRCICiVAr1cJd1br9_H8FTxzzTnTRRbpje9DSnPy9mxywdygGusUG8MbQ"></script>
    <script type="text/javascript" src="https://raw.github.com/lizard-isana/orb.js/master/core.js"></script>
    <script type="text/javascript" src="https://raw.github.com/lizard-isana/orb.js/master/satellite.js"></script>
    <script type="text/javascript">
    var geo = null;
    function getGeo() {
      var tle = {
        "first_line":  "1 25544U 98067A   11318.51274148  .00016717  00000-0  10270-3 0  9003",
        "second_line": "2 25544  51.6365 124.1685 0021724  56.2169 304.1052 15.60123650 24381"
      }
      var satellite = new Orb.Satellite(tle);
      var date = new Date();
      var time = new Orb.Time(date);
      geo = satellite.position.geographic(time);
      return geo;
    }

    var ge;
    var fullScreenState = false;
    var noFullScreenIcon = null;
    var fullScreenIcon = null;
    google.load("earth", "1");
    //google.load("maps", "2");
    
    function init() {
      // Create a button and input box.
      var content = document.getElementById('content');
      google.earth.createInstance('content', initCB, failureCB);

      window.setInterval("update()", 1000);
      //alert("Longitude: " + getGeo()['longitude'] + " Latitude: " + getGeo()['latitude'] + " Altitude: " + getGeo()['altitude']);
    }
    
    function initCB(instance) {
      ge = instance;
      ge.getWindow().setVisibility(true);

      // add a navigation control
      ge.getNavigationControl().setVisibility(ge.VISIBILITY_HIDE);

      // add some layers
      //ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS, true);
      //ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS, true);
      ge.getLayerRoot().enableLayerById(ge.LAYER_TERRAIN, true);
      ge.getOptions().setAtmosphereVisibility(true);

      // Overview Map
      ge.getOptions().setOverviewMapVisibility(true);

      ge.getOptions().setFlyToSpeed(0.8);
      ge.getOptions().setUnitsFeetMiles(false);
      ge.getOptions().setTerrainExaggeration(2.5);

      createFullScreenIcon();
      createNormalScreenIcon();
	  toggleFullScreen();
      
      google.earth.addEventListener(ge.getWindow(), "click", handleMouseClick);

	  // Create the ScreenOverlay
	  var screenOverlay = ge.createScreenOverlay('');

	  // Specify a path to the image and set as the icon
	  var icon = ge.createIcon('');
	  icon.setHref("http://co-cupola.github.com/co-cupola/imgs/cupola-mask_1280x800.png");
	  screenOverlay.setIcon(icon);

	  // Set the ScreenOverlay's position in the window
      var samplecontainer = document.getElementById('fullscreencontainer');

	  screenOverlay.getOverlayXY().setXUnits(ge.UNITS_PIXELS);
	  screenOverlay.getOverlayXY().setYUnits(ge.UNITS_PIXELS);
	  screenOverlay.getOverlayXY().setX(samplecontainer.offsetWidth/2);
	  screenOverlay.getOverlayXY().setY(samplecontainer.offsetHeight/2);

	  // Set the overlay's size in pixels
	  screenOverlay.getSize().setXUnits(ge.UNITS_PIXELS);
	  screenOverlay.getSize().setYUnits(ge.UNITS_PIXELS);
	  screenOverlay.getSize().setX(samplecontainer.offsetWidth);
	  screenOverlay.getSize().setY(samplecontainer.offsetHeight);

	  // Specify the point in the image around which to rotate
	  //screenOverlay.getRotationXY().setXUnits(ge.UNITS_FRACTION);
	  //screenOverlay.getRotationXY().setYUnits(ge.UNITS_FRACTION);
	  //screenOverlay.getRotationXY().setX(0.5);
	  //screenOverlay.getRotationXY().setY(0.5);

	  // Rotate the overlay
	  //screenOverlay.setRotation(25);

	  // Add the ScreenOverlay to Earth
	  ge.getFeatures().appendChild(screenOverlay);

      //ge.getView().setAbstractView(lookAt);
      var camera = ge.getView().copyAsCamera(ge.ALTITUDE_RELATIVE_TO_GROUND);
      camera.setAltitude(40000);
      ge.getView().setAbstractView(camera);
    }
    
    function failureCB(errorCode) {
    }
 
    function handleMouseClick(event){
      var INSET_PIXELS_X = document.getElementById("content").offsetWidth - event.getClientX();
      var INSET_PIXELS_Y = event.getClientY();
      if (INSET_PIXELS_X < 32) {
        if (INSET_PIXELS_Y < 32) {
          toggleFullScreen();
        }
      }
    }
 
    function toggleFullScreen() {
      if (fullScreenState == true) {
        makeNormalScreen();
      } else {
        makeFullScreen();
      }
    }
 
    function makeFullScreen() {
       var samplecontainer = document.getElementById('fullscreencontainer');
       var container = document.getElementById('content');
       container.style.left = 0; 
       container.style.top = 0;
       container.style.width = samplecontainer.offsetWidth + 'px'; 
       container.style.height = samplecontainer.offsetHeight + 'px';
       fullScreenState = true;
       noFullScreenIcon.setVisibility(fullScreenState);
       fullScreenIcon.setVisibility(!fullScreenState);  
    }
 
    function makeNormalScreen() {
       var samplecontainer = document.getElementById('sizecontainer');
       var container = document.getElementById('content');
       container.style.left = samplecontainer.style.left; 
       container.style.top = samplecontainer.style.top;
       container.style.width = samplecontainer.offsetWidth + 'px'; 
       container.style.height = samplecontainer.offsetHeight + 'px';
       fullScreenState = false;
       noFullScreenIcon.setVisibility(fullScreenState);
       fullScreenIcon.setVisibility(!fullScreenState);
    }
 
    function createFullScreenIcon() {
       // create an image for the screen overlay
       var icon = ge.createIcon('');
       icon.setHref('http://earth-api-samples.googlecode.com/svn/trunk/external/dinther_fullscreen_tofull.png');
       // create the screen overlay
       fullScreenIcon = ge.createScreenOverlay('');
       fullScreenIcon.setDrawOrder(60);
       fullScreenIcon.setIcon(icon);
       // anchor point in top left of icon.
       fullScreenIcon.getScreenXY().setXUnits(ge.UNITS_FRACTION);
       fullScreenIcon.getScreenXY().setYUnits(ge.UNITS_FRACTION);
       fullScreenIcon.getScreenXY().setX(1);
       fullScreenIcon.getScreenXY().setY(1);
       // place icon in top left of screen.
       fullScreenIcon.getOverlayXY().setXUnits(ge.UNITS_INSET_PIXELS);
       fullScreenIcon.getOverlayXY().setYUnits(ge.UNITS_INSET_PIXELS);
       fullScreenIcon.getOverlayXY().setX(2);
       fullScreenIcon.getOverlayXY().setY(4);
       // Set icon size.
       fullScreenIcon.getSize().setXUnits(ge.UNITS_PIXELS);
       fullScreenIcon.getSize().setYUnits(ge.UNITS_PIXELS);
       fullScreenIcon.getSize().setY(32);
       fullScreenIcon.getSize().setX(32);
       // add the screen overlay to Earth
       ge.getFeatures().appendChild(fullScreenIcon);
    }
 
    function createNormalScreenIcon() {
       // create an image for the screen overlay
       var icon = ge.createIcon('');
       icon.setHref('http://earth-api-samples.googlecode.com/svn/trunk/external/dinther_fullscreen_tonormal.png');
       // create the screen overlay
       noFullScreenIcon = ge.createScreenOverlay('');
       noFullScreenIcon.setDrawOrder(62);
       noFullScreenIcon.setIcon(icon);
       // anchor point in top left of icon.
       noFullScreenIcon.getScreenXY().setXUnits(ge.UNITS_FRACTION);
       noFullScreenIcon.getScreenXY().setYUnits(ge.UNITS_FRACTION);
       noFullScreenIcon.getScreenXY().setX(1);
       noFullScreenIcon.getScreenXY().setY(1);
       // place icon in top right of screen.
       noFullScreenIcon.getOverlayXY().setXUnits(ge.UNITS_INSET_PIXELS);
       noFullScreenIcon.getOverlayXY().setYUnits(ge.UNITS_INSET_PIXELS);
       noFullScreenIcon.getOverlayXY().setX(2);
       noFullScreenIcon.getOverlayXY().setY(4);
       // Set icon size.
       noFullScreenIcon.getSize().setXUnits(ge.UNITS_PIXELS);
       noFullScreenIcon.getSize().setYUnits(ge.UNITS_PIXELS);
       noFullScreenIcon.getSize().setY(32);
       noFullScreenIcon.getSize().setX(32);
       noFullScreenIcon.setVisibility(false);
       // add the screen overlay to Earth
       ge.getFeatures().appendChild(noFullScreenIcon);
    }
 
    function handleFullScreen(){
      if (window.innerWidth == screen.width) {
        if (window.innerHeight > screen.height - 10) {
          //this is likely caused by pressing F11 on the browser
          makeFullScreen();
        } else if (fullScreenState == true) { 
          makeNormalScreen();
        }
      } else {
        makeNormalScreen();
      }
    }
 
    function update() {
      //alert("update");
      //alert(getGeo());

      var lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
      var camera = ge.getView().copyAsCamera(ge.ALTITUDE_RELATIVE_TO_GROUND);
      
      var onViewChangeEnd = function() {
          lookAt.setLatitude(getGeo()['latitude']);
          lookAt.setLongitude(getGeo()['longitude']);
          ge.getView().setAbstractView(lookAt);
      };

      google.earth.addEventListener(ge.getView(), 'viewchangeend', onViewChangeEnd);
      camera.setAltitude(getGeo()['altitude']);
      ge.getView().setAbstractView(camera);
      google.earth.removeEventListener(ge.getView(), 'viewchangeend', onViewChangeEnd);
      
      // Set new latitude and longitude values
      //lookAt.setLatitude(36.584207);
      //lookAt.setLongitude(-121.754322);
      //lookAt.setLatitude(getGeo()['latitude']);
      //lookAt.setLongitude(getGeo()['longitude']);

      // Update the view in Google Earth
      //ge.getView().setAbstractView(lookAt);
      //ge.getView().setAbstractView(camera);
    }

    google.setOnLoadCallback(init);
    </script>
</head>
<body onresize="handleFullScreen();" bgcolor="#F9F8F9" link="#54006C" vlink="#270037" alink="#00FFFF">
<div id="fullscreencontainer" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"></div>
<div id="sizecontainer" style="position: absolute; left: 10px;width: 99%; height: 800px;"></div>
<div id="content" style="position: absolute; left: 10px; width: 99%; height: 800px;"></div>
</body>
</html>
